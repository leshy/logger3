(function(){
  var ref$, map, keys, values, isEmpty, defaultsDeep, pick, net, colors, os, util, h, Backbone, subscriptionMan, _, influx, db, Fluent, Sails, Udp, Tcp, tcpServer;
  ref$ = require('lodash'), map = ref$.map, keys = ref$.keys, values = ref$.values, isEmpty = ref$.isEmpty, defaultsDeep = ref$.defaultsDeep, pick = ref$.pick;
  net = require('net');
  colors = require('colors');
  os = require('os');
  util = require('util');
  h = require('helpers');
  Backbone = require('backbone4000');
  subscriptionMan = require('subscriptionman2');
  _ = require('underscore');
  import$(exports, require('./index'));
  influx = exports.influx = Backbone.Model.extend4000({
    name: 'influx',
    initialize: function(settings){
      var influx;
      settings == null && (settings = {});
      this.settings = {
        client: {
          series: 'log',
          host: 'localhost',
          port: 8086,
          protocol: 'http',
          username: 'node',
          database: 'logger'
        },
        tagFields: {
          module: true,
          app: true
        }
      };
      defaultsDeep(this.settings, settings);
      this.series = this.settings.client.series;
      this.tagFields = keys(this.settings.tagFields);
      influx = require('influx');
      return this.client = influx(this.settings.client);
    },
    log: function(logEvent){
      return this.client.writePoint(this.series, import$(logEvent.data, logEvent.tags), pick(logEvent.tags, this.tagFields), function(err, res){
        return console.log(err, res);
      });
    }
  });
  db = exports.db = Backbone.Model.extend4000({
    name: 'db',
    initialize: function(settings){
      var this$ = this;
      this.settings = import$({
        name: 'log',
        collection: 'log',
        host: 'localhost',
        port: 27017,
        tail: h.Day * 30
      }, settings);
      this.mongodb = require('mongodb');
      this.db = new this.mongodb.Db(this.settings.name, new this.mongodb.Server(this.settings.host || 'localhost', this.settings.port || 27017), {
        safe: true
      });
      this.db.open();
      this.c = this.db.collection(this.settings.collection);
      this.removeTail();
      return setInterval(function(){
        return this$.removeTail();
      }, h.Hour);
    },
    removeTail: function(cb){
      var splitPoint;
      splitPoint = Math.round((new Date().getTime() - this.settings.tail) / 1000).toString(16);
      return this.c.remove({
        _id: {
          $lt: this.mongodb.ObjectId(splitPoint + "0000000000000000")
        }
      }, cb);
    },
    log: function(logEvent){
      var entry;
      entry = h.extendm({
        time: new Date()
      }, logEvent);
      if (isEmpty(entry.data)) {
        delete entry.data;
      }
      return this.c.insert(entry);
    }
  });
  Fluent = exports.Fluent = Backbone.Model.extend4000({
    name: 'fluent',
    initialize: function(settings){
      this.settings = settings != null
        ? settings
        : {
          host: 'localhost',
          name: 'logger',
          port: 24224
        };
      this.logger = require('fluent-logger');
      return this.logger.configure(os.hostname() + '.n.' + this.settings.name, {
        host: this.settings.host,
        port: this.settings.port
      });
    },
    log: function(logEvent){
      return this.logger.emit(keys(logEvent.tags).join('.'), h.extend(this.settings.extendPacket || {}, logEvent.data));
    }
  });
  Sails = exports.Sails = Backbone.Model.extend4000({
    name: 'sails',
    initialize: function(settings){
      this.settings = settings != null
        ? settings
        : {
          sails: false
        };
      if (!this.settings.sails) {
        throw "Sails instance missing";
      }
      return this.sails = this.settings.sails;
    },
    log: function(logEvent){
      this.sails.sockets.broadcast('log', 'log', logEvent);
      return this.sails.emit('log', logEvent);
    }
  });
  Udp = exports.Udp = Backbone.Model.extend4000({
    name: 'udp',
    initialize: function(settings){
      var UdpGun;
      this.settings = settings != null
        ? settings
        : {
          host: 'localhost',
          port: 6000
        };
      UdpGun = require('udp-client');
      this.gun = new UdpGun(this.settings.port, this.settings.host);
      return this.hostname = os.hostname();
    },
    log: function(logEvent){
      return this.gun.send(new Buffer(JSON.stringify(_.extend({
        type: 'nodelogger',
        host: this.hostname
      }, this.settings.extendPacket || {}, {
        data: logEvent.data,
        tags: keys(logEvent.tags)
      }))));
    }
  });
  Tcp = exports.Tcp = Backbone.Model.extend4000({
    name: 'tcp',
    initialize: function(settings){
      var reconnecto, nssocketClient;
      this.settings = settings != null
        ? settings
        : {
          host: 'localhost',
          port: 6001
        };
      reconnecto = require('lweb3/transports/reconnecto').reconnecto;
      nssocketClient = require('lweb3/transports/client/nssocket').nssocketClient;
      return this.connection = new reconnecto({
        defaultChannelClass: nssocketClient.extend4000({
          defaults: {
            host: this.settings.host,
            port: this.settings.port,
            logger: this.settings.logger
          }
        })
      });
    },
    log: function(logEvent){
      return this.connection.send(_.extend({
        type: 'nodelogger',
        host: this.hostname
      }, this.settings.extendPacket || {}, {
        data: logEvent.data,
        tags: logEvent.tags
      }));
    }
  });
  tcpServer = exports.tcpServer = Backbone.Model.extend4000({
    name: 'tcpServer',
    initialize: function(settings){
      var cnt, server, this$ = this;
      this.settings = settings != null
        ? settings
        : {
          port: 7000,
          host: '0.0.0.0'
        };
      cnt = 0;
      this.clients = {};
      server = net.createServer(function(socket){
        var id;
        id = cnt++;
        this$.clients[id] = socket;
        socket.on('close', function(){
          var ref$, ref1$;
          return ref1$ = (ref$ = this$.clients)[id], delete ref$[id], ref1$;
        });
        return socket.on('error', function(){
          var ref$, ref1$;
          return ref1$ = (ref$ = this$.clients)[id], delete ref$[id], ref1$;
        });
      });
      return server.listen(this.settings.port, this.settings.host);
    },
    log: function(logEvent){
      var this$ = this;
      try {
        return map(function(client){
          return client.write(JSON.stringify(_.extend({
            host: this$.hostname
          }, this$.settings.extendPacket || {}, {
            data: logEvent.data,
            tags: keys(logEvent.tags)
          })) + "\n");
        })(
        values(
        this.clients));
      } catch (e$) {}
    }
  });
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2xlc2gvY29kaW5nL3Jlc2JvdS9ib29raW5nY29tQ2xpZW50L25vZGVfbW9kdWxlcy9sb2dnZXIzL3NlcnZlci5scyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztFQU1FLElBQUEsR0FBQSxPQUFBLENBQUEsUUFBQSxDQUFBLEVBQVUsR0FBVixDQUFBLENBQUEsQ0FBQSxJQUFBLENBQVUsR0FBVixFQUFlLElBQWYsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFlLElBQWYsRUFBcUIsTUFBckIsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFxQixNQUFyQixFQUE2QixPQUE3QixDQUFBLENBQUEsQ0FBQSxJQUFBLENBQTZCLE9BQTdCLEVBQXNDLFlBQXRDLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBc0MsWUFBdEMsRUFBb0QsSUFBcEQsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFvRDtFQUVwRCxHQUFBLENBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxLQUFBO0VBQ0EsTUFBQSxDQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQTtFQUNBLEVBQUEsQ0FBQSxDQUFBLENBQUEsT0FBQSxDQUFBLElBQUE7RUFDQSxJQUFBLENBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxNQUFBO0VBRVMsQ0FBVCxDQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQTtFQUVjLFFBQWQsQ0FBQSxDQUFBLENBQUEsT0FBQSxDQUFBLGNBQUE7RUFDa0IsZUFBbEIsQ0FBQSxDQUFBLENBQUEsT0FBQSxDQUFBLGtCQUFBO0VBQ1ksQ0FBWixDQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQTtVQUdGLFNBQVksUUFBUSxTQUFBO0VBRXBCLE1BQU8sQ0FBQSxDQUFBLENBQUUsT0FBTyxDQUFDLE1BQU8sQ0FBQSxDQUFBLENBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxXQUN2QztJQUFBLE1BQU07SUFDTixZQUFZLFFBQUEsQ0FBQSxRQUFBOztNQUFDLHFCQUFBLFdBQVM7TUFFcEIsSUFBQyxD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b21waWxlXG4jXG4jIHRoaXMgc2hvdWxkIHVzZSBzb21lIHBsdWdpbiBzeXN0ZW0uIGRpZmZlcmVudCBvdXRwdXRzIGhhdmUgdmVyeSBkaWZmZXJuZXQgYW5kIGJlZWZ5IGRlcGVuZGVuY2llc1xuIyBjaGVjayBsZWdvIGJ1dCBhbHNvIGh0dHBzOi8vZ2l0aHViLmNvbS9jOS9hcmNoaXRlY3RcblxucmVxdWlyZSEgeyBcbiAgbG9kYXNoOiB7IG1hcCwga2V5cywgdmFsdWVzLCBpc0VtcHR5LCBkZWZhdWx0c0RlZXAsIHBpY2sgfVxuICBcbiAgbmV0XG4gIGNvbG9yc1xuICBvc1xuICB1dGlsXG5cbiAgaGVscGVyczogaFxuXG4gIGJhY2tib25lNDAwMDogQmFja2JvbmUgIFxuICBzdWJzY3JpcHRpb25tYW4yOiBzdWJzY3JpcHRpb25NYW5cbiAgdW5kZXJzY29yZTogJ18nICBcbn1cblxuZXhwb3J0cyA8PDwgcmVxdWlyZSAnLi9pbmRleCdcblxuaW5mbHV4ID0gZXhwb3J0cy5pbmZsdXggPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQ0MDAwIGRvXG4gIG5hbWU6ICdpbmZsdXgnXG4gIGluaXRpYWxpemU6IChzZXR0aW5ncz17fSkgLT5cbiAgICBcbiAgICBAc2V0dGluZ3MgPSBkb1xuICAgICAgY2xpZW50OiBcbiAgICAgICAgc2VyaWVzOiAnbG9nJyxcbiAgICAgICAgaG9zdDogJ2xvY2FsaG9zdCcsXG4gICAgICAgIHBvcnQ6IDgwODZcbiAgICAgICAgcHJvdG9jb2w6ICdodHRwJ1xuICAgICAgICB1c2VybmFtZTogJ25vZGUnLFxuICAgICAgICBkYXRhYmFzZTogJ2xvZ2dlcidcbiAgICAgIHRhZ0ZpZWxkczogeyArbW9kdWxlLCArYXBwIH1cblxuICAgIGRlZmF1bHRzRGVlcCBAc2V0dGluZ3MsIHNldHRpbmdzXG5cblxuICAgIEBzZXJpZXMgPSBAc2V0dGluZ3MuY2xpZW50LnNlcmllc1xuICAgIEB0YWdGaWVsZHMgPSBrZXlzIEBzZXR0aW5ncy50YWdGaWVsZHNcblxuICAgICAgICAgICAgXG4gICAgaW5mbHV4ID0gcmVxdWlyZSAnaW5mbHV4J1xuICAgIEBjbGllbnQgPSBpbmZsdXggQHNldHRpbmdzLmNsaWVudFxuICAgIFxuICBsb2c6IChsb2dFdmVudCkgLT5cbiAgICAjQGNsaWVudC53cml0ZVBvaW50KHNlcmllc05hbWUsIHZhbHVlcywgdGFncywgW29wdGlvbnNdLCBmdW5jdGlvbihlcnIsIHJlc3BvbnNlKSB7IH0pICAgIFxuICAgIEBjbGllbnQud3JpdGVQb2ludCBkb1xuICAgICAgQHNlcmllc1xuICAgICAgbG9nRXZlbnQuZGF0YSA8PDwgbG9nRXZlbnQudGFnc1xuICAgICAgcGljayBsb2dFdmVudC50YWdzLCBAdGFnRmllbGRzXG4gICAgICAoZXJyLHJlcykgLT5cbiAgICAgICAgY29uc29sZS5sb2cgZXJyLCByZXNcblxuICAgIFxuZGIgPSBleHBvcnRzLmRiICA9IEJhY2tib25lLk1vZGVsLmV4dGVuZDQwMDAgZG9cbiAgbmFtZTogJ2RiJ1xuICBpbml0aWFsaXplOiAoc2V0dGluZ3MpIC0+XG4gICAgQHNldHRpbmdzID0gIHsgbmFtZTogJ2xvZycsIGNvbGxlY3Rpb246ICdsb2cnLCBob3N0OiAnbG9jYWxob3N0JywgcG9ydDogMjcwMTcsIHRhaWw6IGguRGF5ICogMzAgfSA8PDwgc2V0dGluZ3NcbiAgICBAbW9uZ29kYiA9IHJlcXVpcmUgJ21vbmdvZGInXG4gICAgXG4gICAgQGRiID0gbmV3IEBtb25nb2RiLkRiIEBzZXR0aW5ncy5uYW1lLCBuZXcgQG1vbmdvZGIuU2VydmVyKEBzZXR0aW5ncy5ob3N0IG9yICdsb2NhbGhvc3QnLCBAc2V0dGluZ3MucG9ydCBvciAyNzAxNyksIHNhZmU6IHRydWVcbiAgICBAZGIub3BlbigpXG4gICAgQGMgPSBAZGIuY29sbGVjdGlvbiBAc2V0dGluZ3MuY29sbGVjdGlvblxuXG4gICAgQHJlbW92ZVRhaWwoKVxuICAgIHNldEludGVydmFsICh+PiBAcmVtb3ZlVGFpbCgpKSwgaC5Ib3VyXG4gICAgICBcbiAgcmVtb3ZlVGFpbDogKGNiKSAtPlxuICAgIHNwbGl0UG9pbnQgPSBNYXRoLnJvdW5kKChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIEBzZXR0aW5ncy50YWlsKSAvIDEwMDApLnRvU3RyaW5nKDE2KVxuICAgIEBjLnJlbW92ZSB7IF9pZDogeyAkbHQ6IEBtb25nb2RiLk9iamVjdElkKHNwbGl0UG9pbnQgKyBcIjAwMDAwMDAwMDAwMDAwMDBcIikgfSB9LCBjYlxuICAgICAgICAgICAgXG4gIGxvZzogKGxvZ0V2ZW50KSAtPlxuICAgIGVudHJ5ID0gaC5leHRlbmRtIHsgdGltZTogbmV3IERhdGUoKSB9LCBsb2dFdmVudFxuICAgIGlmIGlzRW1wdHkgZW50cnkuZGF0YSB0aGVuIGRlbGV0ZSBlbnRyeS5kYXRhXG4gICAgQGMuaW5zZXJ0IGVudHJ5XG5cbkZsdWVudCA9IGV4cG9ydHMuRmx1ZW50ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kNDAwMCBkb1xuICBuYW1lOiAnZmx1ZW50J1xuICBpbml0aWFsaXplOiAoQHNldHRpbmdzID0geyBob3N0OiAnbG9jYWxob3N0JywgbmFtZTogJ2xvZ2dlcicsIHBvcnQ6IDI0MjI0IH0gKSAtPlxuICAgIEBsb2dnZXIgPSByZXF1aXJlICdmbHVlbnQtbG9nZ2VyJ1xuICAgIEBsb2dnZXIuY29uZmlndXJlIG9zLmhvc3RuYW1lKCkgKyAnLm4uJyArIEBzZXR0aW5ncy5uYW1lLCB7IGhvc3Q6IEBzZXR0aW5ncy5ob3N0LCBwb3J0OiBAc2V0dGluZ3MucG9ydCB9XG4gICAgXG4gIGxvZzogKGxvZ0V2ZW50KSAtPlxuICAgIEBsb2dnZXIuZW1pdCBrZXlzKGxvZ0V2ZW50LnRhZ3MpLmpvaW4oJy4nKSwgaC5leHRlbmQgKEBzZXR0aW5ncy5leHRlbmRQYWNrZXQgb3Ige30pLCBsb2dFdmVudC5kYXRhXG5cblxuU2FpbHMgPSBleHBvcnRzLlNhaWxzID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kNDAwMCBkb1xuICBuYW1lOiAnc2FpbHMnXG4gIGluaXRpYWxpemU6IChAc2V0dGluZ3MgPSB7IHNhaWxzOiBmYWxzZSB9ICkgLT5cbiAgICBpZiBub3QgQHNldHRpbmdzLnNhaWxzIHRoZW4gdGhyb3cgXCJTYWlscyBpbnN0YW5jZSBtaXNzaW5nXCJcbiAgICBAc2FpbHMgPSBAc2V0dGluZ3Muc2FpbHNcbiAgICBcbiAgbG9nOiAobG9nRXZlbnQpIC0+XG4gICAgQHNhaWxzLnNvY2tldHMuYnJvYWRjYXN0ICdsb2cnLCAnbG9nJywgbG9nRXZlbnRcbiAgICBAc2FpbHMuZW1pdCAnbG9nJywgbG9nRXZlbnRcbiAgICBcblVkcCA9IGV4cG9ydHMuVWRwID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kNDAwMCBkb1xuICBuYW1lOiAndWRwJ1xuXG4gIGluaXRpYWxpemU6IChAc2V0dGluZ3MgPSB7IGhvc3Q6ICdsb2NhbGhvc3QnLCBwb3J0OiA2MDAwIH0gKSAtPlxuICAgIFVkcEd1biA9IHJlcXVpcmUgJ3VkcC1jbGllbnQnXG5cbiAgICBAZ3VuID0gbmV3IFVkcEd1biBAc2V0dGluZ3MucG9ydCwgQHNldHRpbmdzLmhvc3RcbiAgICBAaG9zdG5hbWUgPSBvcy5ob3N0bmFtZSgpXG5cbiAgbG9nOiAobG9nRXZlbnQpIC0+XG4gICAgQGd1bi5zZW5kIG5ldyBCdWZmZXIgSlNPTi5zdHJpbmdpZnkgXy5leHRlbmQgeyB0eXBlOiAnbm9kZWxvZ2dlcicsIGhvc3Q6IEBob3N0bmFtZSB9LCAoQHNldHRpbmdzLmV4dGVuZFBhY2tldCBvciB7fSksIHsgZGF0YTogbG9nRXZlbnQuZGF0YSwgdGFnczoga2V5cyBsb2dFdmVudC50YWdzIH1cblxuVGNwID0gZXhwb3J0cy5UY3AgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQ0MDAwIGRvXG4gIG5hbWU6ICd0Y3AnXG4gIGluaXRpYWxpemU6IChAc2V0dGluZ3MgPSB7IGhvc3Q6ICdsb2NhbGhvc3QnLCBwb3J0OiA2MDAxIH0gKSAtPlxuICAgIFxuICAgIHJlY29ubmVjdG8gPSByZXF1aXJlKCdsd2ViMy90cmFuc3BvcnRzL3JlY29ubmVjdG8nKS5yZWNvbm5lY3RvXG4gICAgbnNzb2NrZXRDbGllbnQgPSByZXF1aXJlKCdsd2ViMy90cmFuc3BvcnRzL2NsaWVudC9uc3NvY2tldCcpLm5zc29ja2V0Q2xpZW50XG5cbiAgICBAY29ubmVjdGlvbiA9IG5ldyByZWNvbm5lY3RvIGRvXG4gICAgICBkZWZhdWx0Q2hhbm5lbENsYXNzOiBuc3NvY2tldENsaWVudC5leHRlbmQ0MDAwIGRvXG4gICAgICAgIGRlZmF1bHRzOlxuICAgICAgICAgIGhvc3Q6IEBzZXR0aW5ncy5ob3N0XG4gICAgICAgICAgcG9ydDogQHNldHRpbmdzLnBvcnRcbiAgICAgICAgICBsb2dnZXI6IEBzZXR0aW5ncy5sb2dnZXJcbiAgXG4gIGxvZzogKGxvZ0V2ZW50KSAtPlxuICAgIEBjb25uZWN0aW9uLnNlbmQgXy5leHRlbmQgeyB0eXBlOiAnbm9kZWxvZ2dlcicsIGhvc3Q6IEBob3N0bmFtZSB9LCAoQHNldHRpbmdzLmV4dGVuZFBhY2tldCBvciB7fSksIHsgZGF0YTogbG9nRXZlbnQuZGF0YSwgdGFnczogbG9nRXZlbnQudGFncyB9XG4gICAgXG50Y3BTZXJ2ZXIgPSBleHBvcnRzLnRjcFNlcnZlciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZDQwMDAoXG4gIG5hbWU6ICd0Y3BTZXJ2ZXInXG5cbiAgaW5pdGlhbGl6ZTogKEBzZXR0aW5ncyA9IHsgcG9ydDogNzAwMCwgaG9zdDogJzAuMC4wLjAnIH0gKSAtPlxuICAgIGNudCA9IDBcbiAgICBAY2xpZW50cyA9IHt9XG4gICAgc2VydmVyID0gbmV0LmNyZWF0ZVNlcnZlciAoc29ja2V0KSB+PlxuICAgICAgaWQgPSBjbnQrK1xuICAgICAgQGNsaWVudHNbaWRdID0gc29ja2V0XG4gICAgICBzb2NrZXQub24gJ2Nsb3NlJywgfj4gZGVsZXRlIEBjbGllbnRzW2lkXVxuICAgICAgc29ja2V0Lm9uICdlcnJvcicsIH4+IGRlbGV0ZSBAY2xpZW50c1tpZF1cbiAgICBzZXJ2ZXIubGlzdGVuIEBzZXR0aW5ncy5wb3J0LCBAc2V0dGluZ3MuaG9zdFxuXG4gIGxvZzogKGxvZ0V2ZW50KSAtPlxuICAgIHRyeVxuICAgICAgQGNsaWVudHNcbiAgICAgICAgfD4gdmFsdWVzXG4gICAgICAgIHw+IG1hcCAoY2xpZW50KSB+PlxuICAgICAgICAgIGNsaWVudC53cml0ZSBKU09OLnN0cmluZ2lmeShfLmV4dGVuZCB7IGhvc3Q6IEBob3N0bmFtZSB9LCAoQHNldHRpbmdzLmV4dGVuZFBhY2tldCBvciB7fSksIHsgZGF0YTogbG9nRXZlbnQuZGF0YSwgdGFnczoga2V5cyBsb2dFdmVudC50YWdzIH0pICsgXCJcXG5cIlxuKVxuIl19
