(function(){
  var ref$, objToPairs, empty, map, fold, keys, values, first, flatten, h, net, Backbone, subscriptionMan, colors, UdpGun, os, util, _, db, Fluent, Sails, Udp, Tcp, tcpServer;
  ref$ = require('prelude-ls'), objToPairs = ref$.objToPairs, empty = ref$.empty, map = ref$.map, fold = ref$.fold, keys = ref$.keys, values = ref$.values, first = ref$.first, flatten = ref$.flatten;
  h = require('helpers');
  net = require('net');
  Backbone = require('backbone4000');
  subscriptionMan = require('subscriptionman2');
  colors = require('colors');
  UdpGun = require('udp-client');
  os = require('os');
  util = require('util');
  _ = require('underscore');
  import$(exports, require('./index'));
  db = exports.db = Backbone.Model.extend4000({
    name: 'db',
    initialize: function(settings){
      var this$ = this;
      this.settings = import$({
        name: 'log',
        collection: 'log',
        host: 'localhost',
        port: 27017,
        tail: h.Day * 30
      }, settings);
      this.mongodb = require('mongodb');
      this.db = new this.mongodb.Db(this.settings.name, new this.mongodb.Server(this.settings.host || 'localhost', this.settings.port || 27017), {
        safe: true
      });
      this.db.open();
      this.c = this.db.collection(this.settings.collection);
      this.removeTail();
      return setInterval(function(){
        return this$.removeTail();
      }, h.Hour);
    },
    removeTail: function(cb){
      var splitPoint;
      splitPoint = Math.round((new Date().getTime() - this.settings.tail) / 1000).toString(16);
      return this.c.remove({
        _id: {
          $lt: this.mongodb.ObjectId(splitPoint + "0000000000000000")
        }
      }, cb);
    },
    log: function(logEvent){
      var entry;
      entry = h.extendm({
        time: new Date()
      }, logEvent);
      if (empty(entry.data)) {
        delete entry.data;
      }
      return this.c.insert(entry);
    }
  });
  Fluent = exports.Fluent = Backbone.Model.extend4000({
    name: 'fluent',
    initialize: function(settings){
      this.settings = settings != null
        ? settings
        : {
          host: 'localhost',
          name: 'logger',
          port: 24224
        };
      this.logger = require('fluent-logger');
      return this.logger.configure(os.hostname() + '.n.' + this.settings.name, {
        host: this.settings.host,
        port: this.settings.port
      });
    },
    log: function(logEvent){
      return this.logger.emit(keys(logEvent.tags).join('.'), h.extend(this.settings.extendPacket || {}, logEvent.data));
    }
  });
  Sails = exports.Sails = Backbone.Model.extend4000({
    name: 'sails',
    initialize: function(settings){
      this.settings = settings != null
        ? settings
        : {
          sails: false
        };
      if (!this.settings.sails) {
        throw "Sails instance missing";
      }
      return this.sails = this.settings.sails;
    },
    log: function(logEvent){
      this.sails.sockets.broadcast('log', 'log', logEvent);
      return this.sails.emit('log', logEvent);
    }
  });
  Udp = exports.Udp = Backbone.Model.extend4000({
    name: 'udp',
    initialize: function(settings){
      var UdpGun;
      this.settings = settings != null
        ? settings
        : {
          host: 'localhost',
          port: 6000
        };
      UdpGun = require('udp-client');
      this.gun = new UdpGun(this.settings.port, this.settings.host);
      return this.hostname = os.hostname();
    },
    log: function(logEvent){
      return this.gun.send(new Buffer(JSON.stringify(_.extend({
        type: 'nodelogger',
        host: this.hostname
      }, this.settings.extendPacket || {}, {
        data: logEvent.data,
        tags: keys(logEvent.tags)
      }))));
    }
  });
  Tcp = exports.Tcp = Backbone.Model.extend4000({
    name: 'tcp',
    initialize: function(settings){
      var reconnecto, nssocketClient;
      this.settings = settings != null
        ? settings
        : {
          host: 'localhost',
          port: 6001
        };
      reconnecto = require('lweb3/transports/reconnecto').reconnecto;
      nssocketClient = require('lweb3/transports/client/nssocket').nssocketClient;
      return this.connection = new reconnecto({
        defaultChannelClass: nssocketClient.extend4000({
          defaults: {
            host: this.settings.host,
            port: this.settings.port,
            logger: this.settings.logger
          }
        })
      });
    },
    log: function(logEvent){
      return this.connection.send(_.extend({
        type: 'nodelogger',
        host: this.hostname
      }, this.settings.extendPacket || {}, {
        data: logEvent.data,
        tags: logEvent.tags
      }));
    }
  });
  tcpServer = exports.tcpServer = Backbone.Model.extend4000({
    name: 'tcpServer',
    initialize: function(settings){
      var cnt, server, this$ = this;
      this.settings = settings != null
        ? settings
        : {
          port: 7000,
          host: '0.0.0.0'
        };
      cnt = 0;
      this.clients = {};
      server = net.createServer(function(socket){
        var id;
        id = cnt++;
        this$.clients[id] = socket;
        socket.on('close', function(){
          var ref$, ref1$;
          return ref1$ = (ref$ = this$.clients)[id], delete ref$[id], ref1$;
        });
        return socket.on('error', function(){
          var ref$, ref1$;
          return ref1$ = (ref$ = this$.clients)[id], delete ref$[id], ref1$;
        });
      });
      return server.listen(this.settings.port, this.settings.host);
    },
    log: function(logEvent){
      var this$ = this;
      try {
        return map(function(client){
          return client.write(JSON.stringify(_.extend({
            host: this$.hostname
          }, this$.settings.extendPacket || {}, {
            data: logEvent.data,
            tags: keys(logEvent.tags)
          })) + "\n");
        })(
        values(
        this.clients));
      } catch (e$) {}
    }
  });
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2xlc2gvY29kaW5nL25vZGVsaWJzL2xvZ2dlcjMvc2VydmVyLmxzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0VBQ0EsSUFBQSxHQUFtRSxPQUFuRSxDQUEyRSxZQUFBLENBQTNFLEVBQUUsVUFBK0QsQ0FBQSxDQUFBLENBQWpFLElBQUEsQ0FBRSxVQUFGLEVBQWdCLEtBQWlELENBQUEsQ0FBQSxDQUFqRSxJQUFBLENBQWdCLEtBQWhCLEVBQXVCLEdBQTBDLENBQUEsQ0FBQSxDQUFqRSxJQUFBLENBQXVCLEdBQXZCLEVBQTRCLElBQXFDLENBQUEsQ0FBQSxDQUFqRSxJQUFBLENBQTRCLElBQTVCLEVBQWtDLElBQStCLENBQUEsQ0FBQSxDQUFqRSxJQUFBLENBQWtDLElBQWxDLEVBQXdDLE1BQXlCLENBQUEsQ0FBQSxDQUFqRSxJQUFBLENBQXdDLE1BQXhDLEVBQWdELEtBQWlCLENBQUEsQ0FBQSxDQUFqRSxJQUFBLENBQWdELEtBQWhELEVBQXVELE9BQVUsQ0FBQSxDQUFBLENBQWpFLElBQUEsQ0FBdUQ7RUFDdkQsQ0FBRSxDQUFBLENBQUEsQ0FBRSxRQUFRLFNBQUE7RUFDWixHQUFJLENBQUEsQ0FBQSxDQUFFLFFBQVEsS0FBQTtFQUVkLFFBQVMsQ0FBQSxDQUFBLENBQUUsUUFBUSxjQUFBO0VBQ25CLGVBQWdCLENBQUEsQ0FBQSxDQUFFLFFBQVEsa0JBQUQ7RUFHekIsTUFBTyxDQUFBLENBQUEsQ0FBRSxRQUFRLFFBQUE7RUFHakIsTUFBTyxDQUFBLENBQUEsQ0FBRSxRQUFRLFlBQUE7RUFDakIsRUFBRyxDQUFBLENBQUEsQ0FBRSxRQUFRLElBQUE7RUFDYixJQUFLLENBQUEsQ0FBQSxDQUFFLFFBQVEsTUFBQTtFQUNmLENBQUUsQ0FBQSxDQUFBLENBQUUsUUFBUSxZQUFBO1VBRVosU0FBWSxRQUFRLFNBQUQ7RUFFbkIsRUFBRyxDQUFBLENBQUEsQ0FBRSxPQUFPLENBQUMsRUFBSSxDQUFBLENBQUEsQ0FBRSxRQUFRLENBQUMsS0FBSyxD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LFlBQWpELElBQWlELEVBQTNDLFFBQVEsQ0FBQyxJQUFrQyxDQUFBO0FBQUEsWUFBNUIsSUFBNEIsRUFBdEIsSUFBc0IsQ0FBakIsUUFBUSxDQUFDLElBQVQsQ0FBaUI7QUFBQSxVQUFuRCxDQUFyRCxDQUFWLENBQWtILENBQUEsQ0FBQSxDQUFNLElBQXRJO1NBRFI7UUFESjtRQURMLElBQUMsQ0FBQTs7O0VBZEwsQ0FEdUQiLCJzb3VyY2VzQ29udGVudCI6WyIjYXV0b2NvbXBpbGVcbnsgb2JqLXRvLXBhaXJzLCBlbXB0eSwgbWFwLCBmb2xkLCBrZXlzLCB2YWx1ZXMsIGZpcnN0LCBmbGF0dGVuIH0gPSByZXF1aXJlICdwcmVsdWRlLWxzJ1xuaCA9IHJlcXVpcmUgJ2hlbHBlcnMnXG5uZXQgPSByZXF1aXJlICduZXQnXG5cbkJhY2tib25lID0gcmVxdWlyZSAnYmFja2JvbmU0MDAwJ1xuc3Vic2NyaXB0aW9uTWFuID0gcmVxdWlyZSgnc3Vic2NyaXB0aW9ubWFuMicpXG5cbiMgY29uc29sZSBsb2dnZXJcbmNvbG9ycyA9IHJlcXVpcmUgJ2NvbG9ycydcblxuIyB1ZHAgbG9nZ2VyXG5VZHBHdW4gPSByZXF1aXJlICd1ZHAtY2xpZW50J1xub3MgPSByZXF1aXJlICdvcydcbnV0aWwgPSByZXF1aXJlICd1dGlsJ1xuXyA9IHJlcXVpcmUgJ3VuZGVyc2NvcmUnXG5cbmV4cG9ydHMgPDw8IHJlcXVpcmUoJy4vaW5kZXgnKVxuXG5kYiA9IGV4cG9ydHMuZGIgID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kNDAwMCBkb1xuICBuYW1lOiAnZGInXG4gIGluaXRpYWxpemU6IChzZXR0aW5ncykgLT5cbiAgICBAc2V0dGluZ3MgPSAgeyBuYW1lOiAnbG9nJywgY29sbGVjdGlvbjogJ2xvZycsIGhvc3Q6ICdsb2NhbGhvc3QnLCBwb3J0OiAyNzAxNywgdGFpbDogaC5EYXkgKiAzMCB9IDw8PCBzZXR0aW5nc1xuICAgIEBtb25nb2RiID0gcmVxdWlyZSAnbW9uZ29kYidcbiAgICBcbiAgICBAZGIgPSBuZXcgQG1vbmdvZGIuRGIgQHNldHRpbmdzLm5hbWUsIG5ldyBAbW9uZ29kYi5TZXJ2ZXIoQHNldHRpbmdzLmhvc3Qgb3IgJ2xvY2FsaG9zdCcsIEBzZXR0aW5ncy5wb3J0IG9yIDI3MDE3KSwgc2FmZTogdHJ1ZVxuICAgIEBkYi5vcGVuKClcbiAgICBAYyA9IEBkYi5jb2xsZWN0aW9uIEBzZXR0aW5ncy5jb2xsZWN0aW9uXG5cbiAgICBAcmVtb3ZlVGFpbCgpXG4gICAgc2V0SW50ZXJ2YWwgKH4+IEByZW1vdmVUYWlsKCkpLCBoLkhvdXJcbiAgICAgIFxuICByZW1vdmVUYWlsOiAoY2IpIC0+XG4gICAgc3BsaXRQb2ludCA9IE1hdGgucm91bmQoKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gQHNldHRpbmdzLnRhaWwpIC8gMTAwMCkudG9TdHJpbmcoMTYpXG4gICAgQGMucmVtb3ZlIHsgX2lkOiB7ICRsdDogQG1vbmdvZGIuT2JqZWN0SWQoc3BsaXRQb2ludCArIFwiMDAwMDAwMDAwMDAwMDAwMFwiKSB9IH0sIGNiXG4gICAgICAgICAgICBcbiAgbG9nOiAobG9nRXZlbnQpIC0+XG4gICAgZW50cnkgPSBoLmV4dGVuZG0geyB0aW1lOiBuZXcgRGF0ZSgpIH0sIGxvZ0V2ZW50XG4gICAgaWYgZW1wdHkgZW50cnkuZGF0YSB0aGVuIGRlbGV0ZSBlbnRyeS5kYXRhXG4gICAgQGMuaW5zZXJ0IGVudHJ5XG5cbkZsdWVudCA9IGV4cG9ydHMuRmx1ZW50ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kNDAwMCBkb1xuICBuYW1lOiAnZmx1ZW50J1xuICBpbml0aWFsaXplOiAoQHNldHRpbmdzID0geyBob3N0OiAnbG9jYWxob3N0JywgbmFtZTogJ2xvZ2dlcicsIHBvcnQ6IDI0MjI0IH0gKSAtPlxuICAgIEBsb2dnZXIgPSByZXF1aXJlICdmbHVlbnQtbG9nZ2VyJ1xuICAgIEBsb2dnZXIuY29uZmlndXJlIG9zLmhvc3RuYW1lKCkgKyAnLm4uJyArIEBzZXR0aW5ncy5uYW1lLCB7IGhvc3Q6IEBzZXR0aW5ncy5ob3N0LCBwb3J0OiBAc2V0dGluZ3MucG9ydCB9XG4gIGxvZzogKGxvZ0V2ZW50KSAtPlxuICAgIEBsb2dnZXIuZW1pdCBrZXlzKGxvZ0V2ZW50LnRhZ3MpLmpvaW4oJy4nKSwgaC5leHRlbmQgKEBzZXR0aW5ncy5leHRlbmRQYWNrZXQgb3Ige30pLCBsb2dFdmVudC5kYXRhXG5cblxuU2FpbHMgPSBleHBvcnRzLlNhaWxzID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kNDAwMCBkb1xuICBuYW1lOiAnc2FpbHMnXG4gIGluaXRpYWxpemU6IChAc2V0dGluZ3MgPSB7IHNhaWxzOiBmYWxzZSB9ICkgLT5cbiAgICBpZiBub3QgQHNldHRpbmdzLnNhaWxzIHRoZW4gdGhyb3cgXCJTYWlscyBpbnN0YW5jZSBtaXNzaW5nXCJcbiAgICBAc2FpbHMgPSBAc2V0dGluZ3Muc2FpbHNcbiAgICBcbiAgbG9nOiAobG9nRXZlbnQpIC0+XG4gICAgQHNhaWxzLnNvY2tldHMuYnJvYWRjYXN0ICdsb2cnLCAnbG9nJywgbG9nRXZlbnRcbiAgICBAc2FpbHMuZW1pdCAnbG9nJywgbG9nRXZlbnRcbiAgICBcblVkcCA9IGV4cG9ydHMuVWRwID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kNDAwMCBkb1xuICBuYW1lOiAndWRwJ1xuXG4gIGluaXRpYWxpemU6IChAc2V0dGluZ3MgPSB7IGhvc3Q6ICdsb2NhbGhvc3QnLCBwb3J0OiA2MDAwIH0gKSAtPlxuICAgIFVkcEd1biA9IHJlcXVpcmUgJ3VkcC1jbGllbnQnXG5cbiAgICBAZ3VuID0gbmV3IFVkcEd1biBAc2V0dGluZ3MucG9ydCwgQHNldHRpbmdzLmhvc3RcbiAgICBAaG9zdG5hbWUgPSBvcy5ob3N0bmFtZSgpXG5cbiAgbG9nOiAobG9nRXZlbnQpIC0+XG4gICAgQGd1bi5zZW5kIG5ldyBCdWZmZXIgSlNPTi5zdHJpbmdpZnkgXy5leHRlbmQgeyB0eXBlOiAnbm9kZWxvZ2dlcicsIGhvc3Q6IEBob3N0bmFtZSB9LCAoQHNldHRpbmdzLmV4dGVuZFBhY2tldCBvciB7fSksIHsgZGF0YTogbG9nRXZlbnQuZGF0YSwgdGFnczoga2V5cyBsb2dFdmVudC50YWdzIH1cblxuVGNwID0gZXhwb3J0cy5UY3AgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQ0MDAwIGRvXG4gIG5hbWU6ICd0Y3AnXG4gIGluaXRpYWxpemU6IChAc2V0dGluZ3MgPSB7IGhvc3Q6ICdsb2NhbGhvc3QnLCBwb3J0OiA2MDAxIH0gKSAtPlxuICAgIFxuICAgIHJlY29ubmVjdG8gPSByZXF1aXJlKCdsd2ViMy90cmFuc3BvcnRzL3JlY29ubmVjdG8nKS5yZWNvbm5lY3RvXG4gICAgbnNzb2NrZXRDbGllbnQgPSByZXF1aXJlKCdsd2ViMy90cmFuc3BvcnRzL2NsaWVudC9uc3NvY2tldCcpLm5zc29ja2V0Q2xpZW50XG5cbiAgICBAY29ubmVjdGlvbiA9IG5ldyByZWNvbm5lY3RvIGRvXG4gICAgICBkZWZhdWx0Q2hhbm5lbENsYXNzOiBuc3NvY2tldENsaWVudC5leHRlbmQ0MDAwIGRvXG4gICAgICAgIGRlZmF1bHRzOlxuICAgICAgICAgIGhvc3Q6IEBzZXR0aW5ncy5ob3N0XG4gICAgICAgICAgcG9ydDogQHNldHRpbmdzLnBvcnRcbiAgICAgICAgICBsb2dnZXI6IEBzZXR0aW5ncy5sb2dnZXJcbiAgXG4gIGxvZzogKGxvZ0V2ZW50KSAtPlxuICAgIEBjb25uZWN0aW9uLnNlbmQgXy5leHRlbmQgeyB0eXBlOiAnbm9kZWxvZ2dlcicsIGhvc3Q6IEBob3N0bmFtZSB9LCAoQHNldHRpbmdzLmV4dGVuZFBhY2tldCBvciB7fSksIHsgZGF0YTogbG9nRXZlbnQuZGF0YSwgdGFnczogbG9nRXZlbnQudGFncyB9XG4gICAgXG50Y3BTZXJ2ZXIgPSBleHBvcnRzLnRjcFNlcnZlciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZDQwMDAoXG4gIG5hbWU6ICd0Y3BTZXJ2ZXInXG5cbiAgaW5pdGlhbGl6ZTogKEBzZXR0aW5ncyA9IHsgcG9ydDogNzAwMCwgaG9zdDogJzAuMC4wLjAnIH0gKSAtPlxuICAgIGNudCA9IDBcbiAgICBAY2xpZW50cyA9IHt9XG4gICAgc2VydmVyID0gbmV0LmNyZWF0ZVNlcnZlciAoc29ja2V0KSB+PlxuICAgICAgaWQgPSBjbnQrK1xuICAgICAgQGNsaWVudHNbaWRdID0gc29ja2V0XG4gICAgICBzb2NrZXQub24gJ2Nsb3NlJywgfj4gZGVsZXRlIEBjbGllbnRzW2lkXVxuICAgICAgc29ja2V0Lm9uICdlcnJvcicsIH4+IGRlbGV0ZSBAY2xpZW50c1tpZF1cbiAgICBzZXJ2ZXIubGlzdGVuIEBzZXR0aW5ncy5wb3J0LCBAc2V0dGluZ3MuaG9zdFxuXG4gIGxvZzogKGxvZ0V2ZW50KSAtPlxuICAgIHRyeVxuICAgICAgQGNsaWVudHNcbiAgICAgICAgfD4gdmFsdWVzXG4gICAgICAgIHw+IG1hcCAoY2xpZW50KSB+PlxuICAgICAgICAgIGNsaWVudC53cml0ZSBKU09OLnN0cmluZ2lmeShfLmV4dGVuZCB7IGhvc3Q6IEBob3N0bmFtZSB9LCAoQHNldHRpbmdzLmV4dGVuZFBhY2tldCBvciB7fSksIHsgZGF0YTogbG9nRXZlbnQuZGF0YSwgdGFnczoga2V5cyBsb2dFdmVudC50YWdzIH0pICsgXCJcXG5cIlxuKVxuIl19
